<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OpenMoCo AVR Libraries: OMState Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenMoCo AVR Libraries
   </div>
   <div id="projectbrief">Motion Control and MoCoBus Libraries for the AVR Platform</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('class_o_m_state.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">OMState Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Simple State Machine.  
 <a href="class_o_m_state.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="_o_m_state_8h_source.html">OMState.h</a>&gt;</code></p>

<p><a href="class_o_m_state-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a3aee6e9bc437455b6dd7b3419503d030"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_m_state.html#a3aee6e9bc437455b6dd7b3419503d030">OMState</a> (uint8_t)</td></tr>
<tr class="memitem:ad199af294bd90a766be9159a3ea6b183"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_m_state.html#ad199af294bd90a766be9159a3ea6b183">state</a> (uint8_t)</td></tr>
<tr class="memitem:a65bd7e5ce898070c34a788ad4afdecab"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_m_state.html#a65bd7e5ce898070c34a788ad4afdecab">state</a> ()</td></tr>
<tr class="memitem:a07509b74b2a501937e0f07d42d05c2f9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_m_state.html#a07509b74b2a501937e0f07d42d05c2f9">checkCycle</a> ()</td></tr>
<tr class="memitem:aa76a4746f9a4bd00711e0d97914ef6e4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_m_state.html#aa76a4746f9a4bd00711e0d97914ef6e4">setHandler</a> (uint8_t, void(*)(void))</td></tr>
<tr class="memitem:aaf1319e38e01ad3dd8de737df21a0e64"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_o_m_state.html#aaf1319e38e01ad3dd8de737df21a0e64">clearHandler</a> (uint8_t)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Simple State Machine. </p>
<p>The Simple State Machine class provides the ability to manage transitions between states of a program to allow for easy development of Finite State Machines based on simple numeric state codes.</p>
<p>It provides all means necessary for a code author to describe a series of states in which the engine may exist, callbacks to be executed when the engine is in a given state, and the ability to change or read the current state of the engine.</p>
<p>Basic Example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">        #include &quot;OMState.h&quot;</span></div>
<div class="line">        </div>
<div class="line">         <span class="comment">// three possible states: 0, 1, and 2</span></div>
<div class="line">        <a class="code" href="class_o_m_state.html" title="Simple State Machine.">OMState</a> State = <a class="code" href="class_o_m_state.html#a3aee6e9bc437455b6dd7b3419503d030">OMState</a>(3);</div>
<div class="line">        </div>
<div class="line">        <span class="keywordtype">void</span> setup() {</div>
<div class="line">          </div>
<div class="line">          State.<a class="code" href="class_o_m_state.html#aa76a4746f9a4bd00711e0d97914ef6e4">setHandler</a>(1, state1);</div>
<div class="line">          State.<a class="code" href="class_o_m_state.html#aa76a4746f9a4bd00711e0d97914ef6e4">setHandler</a>(2, state2);</div>
<div class="line">          State.<a class="code" href="class_o_m_state.html#ad199af294bd90a766be9159a3ea6b183">state</a>(1);</div>
<div class="line">          </div>
<div class="line">          Serial.begin(19200);</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordtype">void</span> loop() {</div>
<div class="line">          State.<a class="code" href="class_o_m_state.html#a07509b74b2a501937e0f07d42d05c2f9">checkCycle</a>();</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordtype">void</span> state1() {</div>
<div class="line">          </div>
<div class="line">          Serial.println(<span class="stringliteral">&quot;I&#39;m in state 1!&quot;</span>);</div>
<div class="line">          State.<a class="code" href="class_o_m_state.html#ad199af294bd90a766be9159a3ea6b183">state</a>(2);</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordtype">void</span> state2() {</div>
<div class="line">          </div>
<div class="line">          Serial.println(<span class="stringliteral">&quot;I&#39;m in state 2!&quot;</span>);</div>
<div class="line">          </div>
<div class="line">                <span class="comment">// put state machine into &quot;idle&quot; by setting a state</span></div>
<div class="line">                <span class="comment">// with no callback associated</span></div>
<div class="line">                </div>
<div class="line">          State.<a class="code" href="class_o_m_state.html#ad199af294bd90a766be9159a3ea6b183">state</a>(0);</div>
<div class="line">        }</div>
</div><!-- fragment --><p>The core concepts are as follows:</p>
<p>You must define a series of states by creating a function to be called when in that particular state, and you should always have at least one state that has no callback (0 is recommended). The maximum number of states allowed is defined by OM_STATE_MAX - you may not specify a higher number of states than this.</p>
<p>Every time <a class="el" href="class_o_m_state.html#a07509b74b2a501937e0f07d42d05c2f9">checkCycle()</a> is called, if the current state has a callback associated, that callback will be executed. If no callback is associated with the current state, the engine will remain idle - that is, nothing will be executed.</p>
<p>It is the responsibility of the author to ensure that transitions to subsequent states are handled in their callbacks!</p>
<dl class="section author"><dt>Author:</dt><dd>C. A. Church</dd></dl>
<p>(c) 2011 C. A. Church / Dynamic Perception</p>
<p>This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.</p>
<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p>
<p>You should have received a copy of the GNU General Public License along with this program. If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>. </p>

<p>Definition at line <a class="el" href="_o_m_state_8h_source.html#l00126">126</a> of file <a class="el" href="_o_m_state_8h_source.html">OMState.h</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a3aee6e9bc437455b6dd7b3419503d030"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_o_m_state.html">OMState</a> </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>states</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Class Constructor</p>
<p>Creates a new finite state machine (engine), takes a count of total states up to the specified max number of states.</p>
<p>note: states are zero-indexed, so specifying 8 creates states 0-7.</p>
<p>If you request more than the maximum allowed state values, the engine will be initialized to maximum allowed.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">states</td><td>Number of state transitions in the engine </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_o_m_state_8cpp_source.html#l00045">45</a> of file <a class="el" href="_o_m_state_8cpp_source.html">OMState.cpp</a>.</p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a07509b74b2a501937e0f07d42d05c2f9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void checkCycle </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Run Check Cycle</p>
<p>Runs a Check Cycle against the state machine. If there is a callback associated with the current state, that callback is executed. If no callback is associated, no action is taken. </p>

<p>Definition at line <a class="el" href="_o_m_state_8cpp_source.html#l00087">87</a> of file <a class="el" href="_o_m_state_8cpp_source.html">OMState.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="aaf1319e38e01ad3dd8de737df21a0e64"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void clearHandler </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>p_State</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Clear State Handler</p>
<p>Remove callback associated with given state.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_State</td><td>State code to remove association from. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_o_m_state_8cpp_source.html#l00151">151</a> of file <a class="el" href="_o_m_state_8cpp_source.html">OMState.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="aa76a4746f9a4bd00711e0d97914ef6e4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setHandler </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>p_State</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(void)&#160;</td>
          <td class="paramname"><em>p_cb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Set State Handler</p>
<p>Associates a callback with the given state. If you provide a state code that is higher than the maximum state, it fails silently. The function must take no arguments and return void.</p>
<p>Example:</p>
<div class="fragment"><div class="line"> ...</div>
<div class="line"> </div>
<div class="line"> <a class="code" href="class_o_m_state.html" title="Simple State Machine.">OMState</a> Engine = <a class="code" href="class_o_m_state.html#a3aee6e9bc437455b6dd7b3419503d030">OMState</a>(2);</div>
<div class="line"> </div>
<div class="line"> ...</div>
<div class="line"> </div>
<div class="line"> <span class="keywordtype">void</span> foo() {</div>
<div class="line">   <span class="comment">// .. do something</span></div>
<div class="line"> }</div>
<div class="line"> </div>
<div class="line"> <span class="keywordtype">void</span> setup() {</div>
<div class="line"> </div>
<div class="line">   Serial.begin(19200);</div>
<div class="line">   </div>
<div class="line">   Engine.<a class="code" href="class_o_m_state.html#aa76a4746f9a4bd00711e0d97914ef6e4">setHandler</a>(1, foo);</div>
<div class="line">   </div>
<div class="line"> }</div>
</div><!-- fragment --><dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_State</td><td>The state code to associate with</td></tr>
    <tr><td class="paramname">p_cb</td><td>A function pointer to a function that takes no arguments and returns void </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_o_m_state_8cpp_source.html#l00136">136</a> of file <a class="el" href="_o_m_state_8cpp_source.html">OMState.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="ad199af294bd90a766be9159a3ea6b183"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void state </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>p_State</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Set Current State</p>
<p>Sets the current state of the engine, you must use this to transition the engine from one state to another. </p>

<p>Definition at line <a class="el" href="_o_m_state_8cpp_source.html#l00075">75</a> of file <a class="el" href="_o_m_state_8cpp_source.html">OMState.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a65bd7e5ce898070c34a788ad4afdecab"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t state </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get Current State</p>
<p>Retrieves the current state of the engine.</p>
<dl class="section return"><dt>Returns:</dt><dd>Current state </dd></dl>

<p>Definition at line <a class="el" href="_o_m_state_8cpp_source.html#l00064">64</a> of file <a class="el" href="_o_m_state_8cpp_source.html">OMState.cpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_o_m_state_8h_source.html">OMState.h</a></li>
<li><a class="el" href="_o_m_state_8cpp_source.html">OMState.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="class_o_m_state.html">OMState</a></li>
    <li class="footer">Generated on Sun Jun 17 2012 13:59:33 for OpenMoCo AVR Libraries by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1.1 </li>
  </ul>
</div>
</body>
</html>
